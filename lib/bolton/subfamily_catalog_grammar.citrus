grammar Bolton::SubfamilyCatalogGrammar
  include Bolton::CatalogGrammar

  rule record
    subfamily | tribe | genus | subfamily_header | genus_incertae_sedis_in | other
  end

  rule subfamily
    (bold span 'Subfamily ' fossil_flag? red uppercase_word close_tags) {
      value = {:type => :subfamily, :name => uppercase_word.downcase.capitalize.strip}
      value.merge! :fossil => true if fossil_flag.present?
      value
    }
  end

  rule genus
    (bold span 'Genus' close_tags fossil_flag? bold? italic red uppercase_word close_tags) {
      value = {:type => :genus, :name => uppercase_word.downcase.capitalize.strip}
      value.merge! :fossil => true if fossil_flag.present?
      value
    }
  end

  rule tribe
    (bold span 'Tribe ' red uppercase_word close_tags) {
      value = {:type => :tribe, :name => uppercase_word.downcase.capitalize.strip}
      value.merge! :fossil => true if fossil_flag.present?
      value
    }
  end

  rule genus_incertae_sedis_in
    (bold span 'Genus ' italic 'incertae sedis' tag_end ' in ' red capitalized_word close_tags) {
      {:type => :genus_incertae_sedis_in}
    }
  end

  rule subfamily_header
    (bold span 'SUBFAMILY ' red uppercase_word close_tags) {
      {:type => :subfamily_header}
    }
  end

  rule other
    /.*/ {
      {:type => :other}
    }
  end

end
