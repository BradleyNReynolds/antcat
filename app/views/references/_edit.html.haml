- reference ||= Reference.new
- publisher_string = reference.respond_to?(:publisher) ? (reference.publisher && reference.publisher.to_s) : ''
- journal_name = reference.respond_to?(:journal) ? (reference.journal && reference.journal.name) : ''
- selected_tab = [ArticleReference, BookReference, UnknownReference].index(reference.class) || 0

.reference_edit.ui-corner-all.ui-widget-content.ui-widget
  - url = reference.new_record? ? references_path : reference_path(reference)
  - method = reference.new_record? ? 'post' : 'put'
  - html_options = Rails.env.cucumber? ? {} : {:multipart => true}
  - form_for :reference, reference, :url => url, :html => html_options do |f|
    %input{:type => 'hidden', :name => '_method', :value => method}
    %input{:type => 'hidden', :name => 'selected_tab', :id => 'selected_tab', :class => 'selected_tab', :value => selected_tab}
    = render :partial => 'shared/errors_for', :locals => { :resource => reference }

    %table
      %col{:width => '50px'}
      %col{:width => '*'}
      %col{:align => 'right', :width => '34px'}
      %col{:width => '100px'}
      %tr
        %td Authors
        %td.authors= f.text_field :authors_string, :class => 'authors'
        %td{:style => 'padding-right: 5px'} Year
        %td{:class => :right_side_field}= f.text_field :citation_year
      %tr
        %td Title
        %td{:colspan => 3, :class => :right_side_field}= f.text_area :title, :rows => 2
      %tr
        %td.tabs{:colspan => 4}
          %ul
            %li
              %a{:class => 'article-tab', :href => "#tabs-article-#{reference.id}"}Article
            %li
              %a{:class => 'book-tab', :href => "#tabs-book-#{reference.id}"}Book
            %li
              %a{:class => 'unknown-tab', :href => "#tabs-unknown-#{reference.id}"}Other

          %div{:class => 'article-tab-section', :id => "tabs-article-#{reference.id}"}
            Journal
            = text_field_tag :journal_name, journal_name, :class => 'journal'
            Series volume issue
            = f.text_field :series_volume_issue, :class => 'series_volume_issue'
            Pages
            = text_field_tag :article_pagination, reference.pagination, :class => 'pages'

          %div{:class => 'book-tab-section', :id => "tabs-book-#{reference.id}"}
            Publisher
            = text_field_tag :publisher_string, publisher_string, :class => 'publisher'
            Pages
            = text_field_tag :book_pagination, reference.pagination, :class => 'pages'

          %div{:class => 'unknown-tab-section', :id => "tabs-unknown-#{reference.id}"}
            Citation
            = f.text_area :citation, :rows => 2

      %tr
        %td Source URL
        %td{:colspan => 3, :class => :right_side_field}= f.text_field :source_url
      - unless Rails.env.cucumber?
        %tr
          %td Upload
          %td= file_field_tag :source_file
      %tr
        %td Public notes
        %td{:colspan => 3, :class => :right_side_field}= f.text_area :public_notes, :rows => 2
      %tr
        %td Editor notes
        %td{:colspan => 3, :class => :right_side_field}= f.text_area :editor_notes, :rows => 2
      %tr
        %td Taxonomic notes
        %td{:colspan => 3, :class => :right_side_field}= f.text_area :taxonomic_notes, :rows => 2
      %tr
        %td{:colspan => 4}
          %table.small_fields
            %tr
              %td{:style => 'padding-right: 5px'} Cite code
              %td.cite_code= f.text_field :cite_code
              %td Possess
              %td.possess= f.text_field :possess
              %td Date
              %td.date= f.text_field :date
              %td ID
              %td.date= f.text_field :id, :disabled => 'disabled'
      %tr
        %td{:colspan => 4}
          %button.submit Save
          %button.cancel Cancel
          %button.delete Delete
