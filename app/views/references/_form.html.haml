- reference ||= Reference.new
- publisher_string = reference.respond_to?(:publisher) ? (reference.publisher && reference.publisher.to_s) : ''
- journal_title = reference.respond_to?(:journal) ? (reference.journal && reference.journal.title) : ''
- selected_tab = [ArticleReference, BookReference, OtherReference].index(reference.class) || 0

.reference_form.ui-corner-all.ui-widget-content.ui-widget
  - url = reference.new_record? ? references_path : reference_path(reference)
  - method = reference.new_record? ? 'post' : 'put'
  - form_for :reference, reference, :url => url do |f|
    %input{:type => 'hidden', :name => '_method', :value => method}
    %input{:type => 'hidden', :class => 'selected_tab', :value => selected_tab}
    = render :partial => 'shared/errors_for', :locals => { :resource => reference }

    %table
      %colgroup
        %col{:width => '*'}
        %col{:width => '100px'}
      %tr
        %td.authors= f.text_field :authors_string, :class => 'authors'
        %td{:class => :right_side_field}= f.text_field :citation_year
      %tr
        %td{:colspan => 2, :class => :right_side_field}= f.text_area :title, :rows => 1
      %tr
        %td.tabs{:colspan => 2}
          %ul
            %li
              %a{:class => 'article-tab', :href => "#tabs-article-#{reference.id}"}Article
            %li
              %a{:class => 'book-tab', :href => "#tabs-book-#{reference.id}"}Book
            %li
              %a{:class => 'other-tab', :href => "#tabs-other-#{reference.id}"}Other

          %div{:class => 'article-tab-section', :id => "tabs-article-#{reference.id}"}
            = text_field_tag :journal_title, journal_title, :class => 'journal'
            = f.text_field :series_volume_issue, :class => 'series_volume_issue'
            = ':'
            = text_field_tag :article_pagination, reference.pagination, :class => 'pages'

          %div{:class => 'book-tab-section', :id => "tabs-book-#{reference.id}"}
            = text_field_tag :publisher_string, publisher_string, :class => 'publisher'
            = text_field_tag :book_pagination, reference.pagination, :class => 'pages'

          %div{:class => 'other-tab-section', :id => "tabs-other-#{reference.id}"}
            = f.text_area :citation, :rows => 1

      %tr
        %td{:colspan => 2, :class => :right_side_field}= f.text_area :public_notes, :rows => 1
      %tr
        %td{:colspan => 2, :class => :right_side_field}= f.text_area :editor_notes, :rows => 1
      %tr
        %td{:colspan => 2, :class => :right_side_field}= f.text_area :taxonomic_notes, :rows => 1
      %tr
        %td
          %table.small_fields
            %tr
              %td.cite_code= f.text_field :cite_code
              %td.possess= f.text_field :possess
              %td.date= f.text_field :date
      %tr
        %td{:colspan => 2}
          %button.submit Save
          %button.cancel Cancel
          %button.delete Delete
