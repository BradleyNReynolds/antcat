.protonym-section.callout
  %h5.callout-header
    Protonym:
    -if taxon.persisted?
      =link_to taxon.protonym.decorate.format_name, taxon.protonym
      .right
        =link_to 'Edit', edit_protonym_path(taxon.protonym), class: 'btn-normal btn-tiny jquery-tooltip', title: "Note: Protonyms may be shared and must be edited in a different form. Please save your changes first if you would like to keep them."
    -else
      Select existing or create new

  -if taxon.persisted?
    %table.unstriped
      %tr
        %td=form.label :protonym
        %td=form.protonym_select :protonym

    -protonym = taxon.protonym
    %table.table.unstriped.gray-text.with-gray-links#existing-protonym
      %tbody
        %tr
          %td Authorship
          %td=protonym.authorship.reference.decorate.expandable_reference
        %tr
          %td Pages and forms
          %td=protonym.decorate.format_pages_and_forms
        %tr
          %td Locality
          %td=protonym.decorate.format_locality
        %tr
          %td Primary type information
          %td=add_period_if_necessary ::Types::FormatTypeField[protonym.primary_type_information_taxt]
        %tr
          %td Secondary type information
          %td=add_period_if_necessary ::Types::FormatTypeField[protonym.secondary_type_information_taxt]
        %tr
          %td Type notes
          %td=add_period_if_necessary ::Types::FormatTypeField[protonym.type_notes_taxt]
        %tr
          %td Notes
          %td=or_dash Detax[protonym.authorship.notes_taxt]
  -else
    %h5.callout-header Existing protonym (leave blank if you are creating a new protonym)
    %table.unstriped
      %tr
        %td=form.label :protonym
        %td=form.protonym_select :protonym

    %h5.callout-header New protonym (this will be ignored if an existing protonym is set)
    =form.fields_for :protonym do |protonym_form|
      %table.unstriped
        %tr
          =protonym_form.fields_for :name do |name_form|
            -if name_form.object.new_record?
              =hidden_field_tag 'taxon[protonym_attributes][name_attributes][id]'
            %td
              =name_form.label :name do
                Name
                =tooltip_icon "protonym", scope: :taxa
            %td
              #protonym_name_field
                =render 'name_fields/panel', name_string: taxon.protonym.name.try(:name)
        %tr
          %td
          %td
            =protonym_form.check_box :fossil
            =protonym_form.label :fossil

            =protonym_form.check_box :sic
            =form.label :sic do
              Sic
              =tooltip_icon "sic", scope: :taxa

        =protonym_form.fields_for :authorship do |authorship_form|
          %tr
            %td
              =authorship_form.label :reference do
                Authorship
                =tooltip_icon "authorship", scope: :taxa
            %td=authorship_form.reference_select :reference

          %tr
            %td
              =authorship_form.label :pages do
                Pages
                =tooltip_icon "pages", scope: :taxa
            %td=authorship_form.text_field :pages

          -unless taxon.is_a? Tribe
            %tr
              %td
                =authorship_form.label :forms do
                  Forms
                  =tooltip_icon "forms", scope: :taxa
              %td=authorship_form.text_field :forms

            %tr
              %td
                =protonym_form.label :locality do
                  Locality
                  =tooltip_icon "locality", scope: :taxa
              %td=protonym_form.text_field :locality, class: 'locality-autocomplete-js-hook'

          %tr
            %td=form.label :primary_type_information
            %td=render 'shared/taxt_editor/template', name: 'taxon[protonym_attributes][primary_type_information_taxt]', content: taxon.protonym.primary_type_information_taxt, id: :taxon_protonym_attributes_primary_type_information_taxt
          %tr
            %td=form.label :secondary_type_information
            %td=render 'shared/taxt_editor/template', name: 'taxon[protonym_attributes][secondary_type_information_taxt]', content: taxon.protonym.secondary_type_information_taxt, id: :taxon_protonym_attributes_secondary_type_information_taxt
          %tr
            %td=form.label :type_notes
            %td=render 'shared/taxt_editor/template', name: 'taxon[protonym_attributes][type_notes_taxt]', content: taxon.protonym.type_notes_taxt, id: :taxon_protonym_attributes_type_notes

          %tr
            %td=form.label :notes_taxt, 'Notes'
            %td=render 'shared/taxt_editor/template', name: 'taxon[protonym_attributes][authorship_attributes][notes_taxt]', content: taxon.protonym.authorship.notes_taxt, id: :taxon_protonym_attributes_authorship_attributes_notes_taxt
