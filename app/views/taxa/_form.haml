=enable_tooltips

-content_for :head do
  =javascript_include_tag 'controllers/taxa/form/locality_autocompletion'
  =javascript_include_tag 'controllers/taxa/not_really_form/reorder_history_items'
  =javascript_include_tag 'controllers/taxa/not_really_form/synonyms_section'
  =javascript_include_tag 'taxon_select', 'reference_select', 'markdown_and_friends', 'taxt_editor'
  =javascript_include_tag 'protonym_select'
  =javascript_include_tag 'check_name_conflicts'

=render 'shared/taxt_editor/taxon_and_ancestors', taxon: @taxon
=render "shared/default_reference"

-url = @taxon.new_record? ?  '/taxa': "/taxa/#{@taxon.id}"
=form_for @taxon, as: :taxon, url: url do |form|
  =hidden_field_tag 'rank_to_create', params[:rank_to_create]
  =hidden_field_tag 'parent_id', params[:parent_id]

  =render 'shared/errors_for', resource: @taxon

  -if @taxon.has_soft_validation_warnings?
    #soft-validations.callout.warning.small-12.medium-6{data: { closable: true }}
      %h6 Issues
      %p These issues will not prevent you from saving the form. Just so you know :)
      =render 'shared/soft_validation_warnings', soft_validation_warnings: @taxon.soft_validation_warnings

      %button.close-button{"aria-label" => "Dismiss alert", data: { close: true }, type: "button"}
        %span{"aria-hidden" => "true"} &times;

  .callout
    =render 'taxa/_form/main_form',        taxon: @taxon, form: form, default_name_string: @default_name_string
    =render 'taxa/_form/protonym_section', taxon: @taxon, form: form, default_name_string: @default_name_string
    =render 'taxa/_form/type_section',     taxon: @taxon, form: form

    .row
      .medium-3.columns
        =text_field_tag :edit_summary, params[:edit_summary], placeholder: "Edit summary (optional)", maxlength: Activity::EDIT_SUMMARY_MAX_LENGTH

      .medium-3.columns.end
        =button_tag type: 'submit', id: "save-taxon-form", class: 'btn-saves button has-spinner' do
          =spinner_icon + 'Save'
        &nbsp;
        -cancel_link = @taxon.new_record? ? catalog_path(params[:parent_id]) : catalog_path(@taxon)
        =link_to 'Cancel', cancel_link, class: 'button btn-nodanger'
        =tooltip_icon :cancel, scope: :taxa

-unless @taxon.new_record?
  .not-really-taxon-form
    =render 'taxa/_not_really_form/history_items_section', taxon: @taxon
    =render 'taxa/_not_really_form/children_section', taxon: @taxon, max_number: 50
    =render 'taxa/_not_really_form/synonyms_section', taxon: @taxon
    =render 'taxa/_not_really_form/references_section', taxon: @taxon
