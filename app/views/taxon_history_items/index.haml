-title "Search History Items"
-breadcrumb :search_taxon_history_items

-content_for :javascripts do
  =javascript_include_tag "sortable_tables"

-content_for :breadcrumbs_right do
  -# NOTE: Added as a dropdown because that was less confusing.
  .btn-normal.dropdown.button{data: { toggle: "more-dropdown"}, type: "button"} Other Search forms
  #more-dropdown.dropdown-pane{data: { dropdown: 'true', hover: 'true', hover_pane: 'true' }}
    %ul.no-bullet
      %li=link_to "Search Reference Sections form", reference_sections_path, class: 'btn-normal'

=form_tag request.path, method: :get do
  .row
    .small-6.medium-4.large-2.columns
      =select_tag :search_type, options_for_select([["LIKE (default)", "LIKE"], ["REGEXP", "REGEXP"]], params[:search_type]), prompt: "Search type"
    .small-6.medium-4.large-4.columns
      =text_field_tag :q, params[:q], placeholder: "Search query"
    .small-6.medium-4.large-4.columns.end
      =text_field_tag :nq, params[:nq], placeholder: "Exclude search query"

  .row
    .small-6.medium-4.large-2.columns
      =select_tag :taxon_type, options_for_select(Rank::TYPES, params[:taxon_type]), include_blank: "Taxon rank"
    .small-6.medium-4.large-2.columns
      =select_tag :taxon_status, options_for_select(Status::STATUSES, params[:taxon_status]), include_blank: "Taxon status"
    .small-6.medium-4.large-2.columns
      =per_page_select TaxonHistoryItemsController::PER_PAGE_OPTIONS, params[:per_page]
    .small-6.medium-4.large-2.columns.end
      =button_tag "Search ".html_safe + search_icon, type: "submit", name: nil, class: "btn-normal"
      &nbsp;
      =link_to "Clear", request.path, class: "button btn-nodanger"

-if current_user && @taxon_history_items.present?
  .callout.no-border-callout.logged-in-only-background.small-text
    .right=logged_in_only_tooltip_icon
    .row
      .medium-6.columns
        %pre=JSON.pretty_generate(@taxon_history_items.joins(:taxon).group(:type).count)
      .medium-6.columns
        %pre=JSON.pretty_generate(@taxon_history_items.joins(:taxon).group(:status).count)

%table.tablesorter
  %caption
    =number_with_delimiter @taxon_history_items.count
    result(s)
  %thead
    %tr
      %th ID
      %th Pos.
      %th Taxon
      %th Rank
      %th Status
      %th Taxt
  -if @taxon_history_items.empty?
    %tr
      %td{colspan: 3} Found no results.
  -@taxon_history_items.each do |history_item|
    %tr
      %td=link_to "##{history_item.id}", history_item
      %td=history_item.position
      %td=CatalogFormatter.link_to_taxon(history_item.taxon)
      %td=history_item.taxon.rank
      %td=history_item.taxon.status
      %td=Detax[history_item.to_taxt]

=will_paginate @taxon_history_items

.callout.margin-top
  =render "shared/note_on_taxt_references"
