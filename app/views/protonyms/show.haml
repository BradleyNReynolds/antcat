-@title = "#{@protonym.name.name} - Protonyms"
-breadcrumb :protonym, @protonym

=enable_tooltips

=content_for :breadcrumbs_right do
  =link_to "History", protonym_history_path(@protonym), class: "btn-normal"
  -if user_is_at_least_helper?
    =link_to 'Edit', edit_protonym_path(@protonym), class: "btn-normal"
    -if !@protonym.taxa.exists?
      =link_to "Delete", protonym_path(@protonym), method: :delete, data: { confirm_with_edit_summary: true }, class: "btn-warning"

-if AntCat::SHOW_SOFT_VALIDATION_WARNINGS_IN_CATALOG
  -if current_user && @protonym.soft_validation_warnings.present?
    .row
      .medium-9.columns
        #soft-validations.callout.warning
          %h6
            Issues
            =logged_in_only_tooltip_icon
          =render 'shared/soft_validation_warnings', soft_validation_warnings: @protonym.soft_validation_warnings

.row.margin-bottom
  .small-12.columns
    %h5
      Protonym:
      =@protonym.decorate.format_name
      -if @protonym.sic?
        [sic]
      .right=link_to "Name record ##{@protonym.name.id}", name_path(@protonym.name), class: 'btn-normal btn-tiny'
    %table.table.unstriped
      %tbody
        %tr
          %th Authorship
          %td=@protonym.authorship.reference.decorate.expandable_reference
        %tr
          %th Pages
          %td=@protonym.authorship.pages
        %tr
          %th Forms
          %td=or_dash @protonym.authorship.forms
        %tr
          %th Biogeographic region
          %td=@protonym.biogeographic_region
        %tr
          %th Locality
          %td=@protonym.decorate.format_locality
        %tr
          %th Primary type information
          %td=add_period_if_necessary ::Types::FormatTypeField[@protonym.primary_type_information_taxt]
        %tr
          %th Secondary type information
          %td=add_period_if_necessary ::Types::FormatTypeField[@protonym.secondary_type_information_taxt]
        %tr
          %th Type notes
          %td=add_period_if_necessary ::Types::FormatTypeField[@protonym.type_notes_taxt]
        %tr
          %th Notes
          %td=or_dash Detax[@protonym.authorship.notes_taxt]

-if @protonym.taxa.present?
  .row.margin-bottom
    .small-12.columns
      %h5 Taxa belonging to this protonym
      %table
        %thead
          %th Taxon
          %th Rank
          %th Status
          %th
        -@protonym.taxa.each do |taxon|
          %tr
            %td=taxon.link_to_taxon
            %td=taxon.rank.capitalize
            %td
              =taxon.status.capitalize
              -unless taxon.status.in?(Taxa::TaxonStatus::SELF_STATUSES)
                %br
                %small=taxon.decorate.taxon_status
            %td
              -if taxon.original_combination?
                Original combination
                =antcat_icon 'check'

-# TODO: See https://github.com/calacademy-research/antcat/issues/702
-if current_user
  -if @protonym.taxa_with_history_items.present?
    .row.margin-bottom
      .small-12.columns
        .callout.no-border-callout.logged-in-only-background
          %h5
            Taxonomic history
            =logged_in_only_tooltip_icon
          -@protonym.taxa_with_history_items.each do |taxon|
            %h6
              =taxon.link_to_taxon
              %span.small-text=taxon.decorate.taxon_status

            .left-margin
              %ul.history
                -taxon.history_items.each do |history_item|
                  %li
                    =add_period_if_necessary Detax[history_item.taxt]
                    -if current_user
                      %span.show-on-hover
                        -if user_is_at_least_helper?
                          =link_to "Edit", edit_taxon_history_item_path(history_item), class: "btn-normal btn-very-tiny"
                        =link_to "History", taxon_history_item_history_path(history_item), class: "btn-normal btn-very-tiny"
